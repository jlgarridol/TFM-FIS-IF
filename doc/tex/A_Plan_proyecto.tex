\apendice{Plan de Proyecto Software}

\section{Introducción}

En este apéndice se expondrán los distintos \textit{sprints} que se han realizado y un estudio de la viabilidad del proyecto.

\section{Planificación temporal}

La planificación temporal se ha realizado adaptando la metodología \textit{Scrum}. Para poder adaptarlo a un trabajo de una sola persona para un proyecto educativo se han considerado las siguientes indicaciones:

\begin{itemize}
	\item El desarrollo se ha basado en iteraciones o \textit{sprints} de dos semana de duración aproximadamente.
	\item Cada uno de los \textit{sprints} contiene las tareas que se realizaron en el mismo. 
	\item Cada tarea tiene un coste estimado dependiendo de lo que el programador estime conveniente siguiendo los parámetros de tiempo a emplear, dificultad técnica entre otros.
	\item Una vez concluida una tarea se especifica el coste real para poder estimar de una manera más correcta tareas de \textit{sprints} siguientes.
	\item Al finalizar cada \textit{sprint} se realiza una reunión con los tutores del proyecto.
\end{itemize}

\subsection{Sprint 0}

El \textit{sprint} 0 consistió en el desarrollo de la aplicación web para la recogida de datos para el proyecto. Es el único \textit{sprint} realizado en colaboración con el alumno José Miguel Ramírez Sanz. 

\begin{table}[H]
	\begin{tabularx}{\linewidth}{X r r}
		\toprule \textbf{Tarea} & \textbf{Est.} & \textbf{Final}\\
		\otoprule
		Diseño de la interfaz web & 3 & 3 \\
		Creación de la plantilla maestra de toda la web & 3 & 2 \\
		Creación de la plantilla base para el menú del paciente & 5 & 5 \\
		Implementación del menú del terapeuta & 2 & 2 \\
		Creación de la conexión para videollamada - Terapeuta & 1 & 1 \\
		Creación de la conexión para videollamada - Paciente & 1 & 1 \\
		Implementación del sistema de inicio de sesión & 2 & 3 \\
		Creación de \textit{plugin} para la captura y emisión del vídeo del paciente & 8 & 13 \\
		Creación de la interfaz de gestión del paciente  & 2 & 2	\\	
		\bottomrule
	\end{tabularx}
	\caption{Tareas del \textit{sprint} 0}
	\label{tab:sprint0}
\end{table}

La mayor dificultad en este \textit{sprint} fue la creación del \textit{plugin} sobre \textit{Jitsi} que duplicase el flujo de vídeo y emitiese los datos del servidor al sistema de colas. Esto fue debido a la poca documentación de \textit{Jitsi} sobre la implantación de estas modificaciones. 


\subsection{Sprint 1}

El \textit{sprint} 1 consistió en la exploración de herramientas para la creación y procesado de flujos de vídeo. 

\begin{table}[H]
	\begin{tabularx}{\linewidth}{X r r}
		\toprule \textbf{Tarea} & \textbf{Est.} & \textbf{Final}\\
		\otoprule
		Búsqueda de herramientas para la creación de flujos de datos & 3 & 3 \\
		Pruebas sobre \textit{Apache Flume} & 5 & 3 \\
		Pruebas sobre \textit{Apache Kafka} & 5 & 5 \\
		Búsqueda de herramientas para el despliegue por contenedores & 3 & 3 \\
		Prueba de despliegue de \textit{Apache Kafka} para \textit{Docker} & 3 & 3 \\
		Búsqueda de herramientas para el procesado de flujos de vídeo & 3 & 3 \\
		Pruebas con \textit{Spark Streaming} con \textit{OpenCV} & 5 & 13 \\
		\bottomrule
	\end{tabularx}
	\caption{Tareas del \textit{sprint} 1}
	\label{tab:sprint1}
\end{table}

El desarrollo de este \textit{sprint} fue bastante similar a lo planificado. El caso particular estuvo en la última tarea debido a la complejidad conectar y procesar de manera efectiva \textit{Spark Streaming} con la librería de OpenCV y poder garantizar que no se perdían \textit{frames.}

\subsection{Sprint 2}

El \textit{sprint} 2 consistió en la implementación de las conexiones entre todos los elementos del flujo a nivel local. 

\begin{table}[H]
	\begin{tabularx}{\linewidth}{X r r}
		\toprule \textbf{Tarea} & \textbf{Est.} & \textbf{Final}\\
		\toprule
		Despliegue local de \textit{Apache Spark} & 2 & 2\\
		Despliegue local de \textit{Apache Kafka} & 3 & 5\\
		Simulación de servidor UDP para vídeo & 5 & 5 \\
		Ingestor a Kafka del vídeo UDP & 3 & 5\\
		Conectar \textit{Spark Streaming} con \textit{Kafka}& 3 & 13\\
		Implementar un anonimizador de rostros & 3 & 2\\
		Parametrizar todos los \textit{scripts} creados & 2 & 2	\\
		\bottomrule
	\end{tabularx}
	\caption{Tareas del \textit{sprint} 2}
	\label{tab:sprint2}
\end{table}

La razón de la gran diferencia en la quinta tarea del \textit{sprint} entre predicho e invertido fue debido a que la documentación de \textit{Kafka} no estaba bien detallada para conectar con \textit{Spark Streaming}. 

\subsection{Sprint 3}

El \textit{sprint} 3 consistió en la implementación de una infraestructura de contenedores \textit{Docker} que conectase todos los servicios para el flujo. 

\begin{table}[H]
	\begin{tabularx}{\linewidth}{X r r}
		\toprule \textbf{Tarea} & \textbf{Est.} & \textbf{Final}\\
		\otoprule
		Despliegue de \textit{Apache Spark} para el nodo \textit{master} & 2 & 2\\
		Despliegue de \textit{Apache Spark} para varios nodos \textit{worker} & 2 & 1\\
		Creación de imágenes \textit{Docker} para soportar las aplicaciones creadas & 8 & 21\\
		Despliegue de la aplicación \textit{openCV} & 3 & 3 \\
		Recogida de \textit{stream} de vídeo e ingestión en \textit{Kafka} en \textit{Docker} & 8 & 8\\
		\bottomrule
	\end{tabularx}
	\caption{Tareas del \textit{sprint} 3}
	\label{tab:sprint3}
\end{table}

Este \textit{sprint} fue más sencillo que el anterior, principalmente porque en el anterior existieron dificultades para cumplir con los plazos del mismo al complicarse la tarea de conectar dos de los componentes. Con la experiencia obtenida en ese \textit{sprint} algunas tareas se desarrollaron más fácilmente. Por otro lado el despliegue con \textit{docker} necesitó casi un \textit{sprint} aparte ya que muchas de las operaciones, a \textit{priori} simples, resultaron tener varias capas de complejidad no previstas. Esto causó el mayor desajuste entre lo previsto y lo invertido de todo el proyecto, presumiblemente por la poca experiencia previa en el uso de contenedores \textit{docker}.

\subsection{Sprint 4}

El \textit{sprint} 4 consistió en la automatización de los procesos del \textit{sprint} 3. 

\begin{table}[H]
	\begin{tabularx}{\linewidth}{X r r}
		\toprule \textbf{Tarea} & \textbf{Est.} & \textbf{Final}\\
		\otoprule
		\textit{Script} para la creación de \textit{topics} de \textit{Kafka} & 1 & 1\\
		\textit{Script} de lanzamiento de instancia del flujo & 8 & 13 \\
		\textit{Script} de inicialización de los servicios & 2 & 2\\
		\textit{Script} para la eliminiación de un \textit{topic} de \textit{Kafka} & 1 & 1\\
		\textit{Script} para el cierre ordenado de un flujo & 5 & 8\\
		\textit{Script} para el apagado completo de los servicios & 1 & 1\\
		\bottomrule
	\end{tabularx}
	\caption{Tareas del \textit{sprint} 4}
	\label{tab:sprint4}
\end{table}

La mayor dificultad de este \textit{sprint} estuvo en la creación de los \textit{scripts} que abarcasen tanto el inicio como el cierre de un flujo debido a que estaban involucrados tanto el inicio de las imágenes \textit{docker} asociadas, el control de identificadores (realizado mediante semáforos en forma de ficheros) y la ejecución ordenada. Por estos motivos las predicciones no fueron acertadas al complicarse la implementación.

\subsection{Sprint 5}

El \textit{sprint} 5 consistió en la creación de experimentos para evaluar el tiempo necesitado para el procesado del flujo además de la búsqueda de un sistema de serialización y compresión adecuado para el encolado de los fotogramas. 

\begin{table}[H]
	\begin{tabularx}{\linewidth}{X r r}
		\toprule \textbf{Tarea} & \textbf{Est.} & \textbf{Final}\\
		\toprule
		Diseño de los experimentos & 3 & 3\\
		Implementación de los experimentos del flujo & 5 & 13\\
		Implementación de los experimentos sobre las técnicas de serialización y compresión & 5 & 5\\
		Implementación de la recogida y visualización de los resultados & 3 & 3\\
		Análisis de los resultados & 3 & 3\\
		\bottomrule
	\end{tabularx}
	\caption{Tareas del \textit{sprint} 5}
	\label{tab:sprint5}
\end{table}

Hubo una gran dificultad a la hora de la implementación de los experimentos debido a que se quiso paralelizar la ejecución y acelerar así el proceso. Sin embargo, esto conllevó un estudio más en profundidad de las herramientas de \textit{Python} para ello.

\subsection{Sprint 6}

En este penúltimo \textit{sprint} se comenzó el despliegue real y la integración con el modelo predictivo de poses del alumno José Miguel Ramírez Sanz. 

\begin{table}[H]
	\begin{tabularx}{\linewidth}{X r r}
		\toprule \textbf{Tarea} & \textbf{Est.} & \textbf{Final}\\
		\toprule
		Implementación de la extensibilidad del flujo & 2 & 2\\
		Instalación local del flujo completo & 3 & 3\\
		Instalación de las librerías necesarias en el equipo \textit{Gamma} & 1 & 1\\
		Despliegue de las máquinas \textit{docker} en \textit{Gamma} & 1 & 1\\
		Pruebas sobre vídeos pregrabados & 2 & 2\\
		Adaptación de los \textit{dockers} para compatibilidad con \textit{Nvidia} & 8 & 13\\
		Diseño de experimentos sobre el flujo completo & 1 & 1\\
		Implementación de los experimentos & 8 & 5\\
		Análisis de los resultados & 2 & 2\\
		\bottomrule
	\end{tabularx}
	\caption{Tareas del \textit{sprint} 6}
	\label{tab:sprint6}
\end{table}

El \textit{sprint} se desarrolló con bastante facilidad respecto a otros debido principalmente a que gran parte del material necesario, como los \textit{scripts} de lanzamiento o experimentos similares, ya se habían creado anteriormente. El único problema estuvo relacionado con la adaptación de las imágenes \textit{Docker} a \textit{Nvida} ya que se requirieron muchos cambios inesperados para que funcionase adecuadamente.

\subsection{Sprint 7}

Este último \textit{sprint} consistió en la creación de la documentación del trabajo realizado. 

\begin{table}[H]
	\begin{tabularx}{\linewidth}{X r r}
		\toprule \textbf{Tarea} & \textbf{Est.} & \textbf{Final}\\
		\otoprule
		Maquetación de la plantilla & 1 & 1\\
		Escritura de la introducción & 2 & 2\\
		Escritura de los objetivos & 3 & 3\\
		Escritura de los conceptos teóricos & 5 & 5\\
		Escritura de los aspectos relevantes & 13 & 13\\
		Escritura de los trabajos relacionados & 3 & 3\\
		Escritura de las conclusiones y lineas futuras & 2 & 2\\
		Escritura del plan de proyecto & 2 & 2\\
		Escritura del diseño & 5 & 5\\
		Escritura del manual del programador & 3 & 3\\
		Creación de la presentación & 8 & 8\\  
		\bottomrule
	\end{tabularx}
	\caption{Tareas del \textit{sprint} 7}
	\label{tab:sprint7}
\end{table}


\section{Estudio de viabilidad}


\subsection{Viabilidad económica}

Debido a que este TFM está dentro de un proyecto donde también se encuentra el TFM de José Miguel Ramírez Sanz, se ha realizado el estudio de viabilidad económica de manera conjunta


En la \autoref{tab:costes_personal} se encuentran los costes total en salarios en jornada completa durante seis meses para dos empleados.

\begin{table}[H]\centering
	\begin{tabular}[]{@{}l r@{}}
		\toprule
		\textbf{Concepto} & \textbf{Coste (\euro{})} \\
		\midrule
		Salario mensual bruto~\cite{salariales} & 2\,047,78 \\
		Seguridad Social (30,04\%) & 615,15 \\
		Retención IRPF (2\%) & 28,65 \\
		Salario mensual neto & 1\,403,97 \\\hubu
		\textbf{Total 6 meses y dos empleados} &  24\,573,36 \\
		\bottomrule
	\end{tabular}
	\caption{Costes de personal.}
	\label{tab:costes_personal}
\end{table}

La \autoref{tab:costes_hardware} están las inversiones y amortizaciones  en materia de \textit{hardware}, tanto los \textit{MainFrames} para el despliegue y el cálculo como los equipos de desarrollo.


\begin{table}[H]
	\centering
	\begin{tabular}[]{@{}l r r@{}}
		\toprule
		\textbf{Concepto} & \textbf{Coste (\euro{})} & \textbf{Coste amortizado (\euro{})} \\
		\otoprule
		Ordenador de desarrollo (x2) & 950 &  59,37\\
		Dispositivos pacientes (x9) & 100 & 6,25\\
		\textit{Webcam} pacientes (x9) & 150 &9,38\\
		\textit{MainFrame Gamma}  & 3\,000 & 187,5 \\ 
		\textit{Gamma} GPU (x3) & 1\,500 &  93,75\\
		\textit{MainFrame Alpha}  & 2\,000 & 125 \\\hubu
		\textbf{Total} & 13\,650 & 853,16\\
		\bottomrule
	\end{tabular}
	\caption{Costes de \textit{hardware}.}
	\label{tab:costes_hardware}
\end{table}

Por último en la \autoref{tab:costes_servicios} se encuentran los dos servicios contratados para dar acceso a la aplicación a los pacientes.

\begin{table}[H]
	\centering
	\begin{tabular}[]{@{}l r@{}}
		\toprule
		\textbf{Servicio} & \textbf{Coste (\euro{})}\\
		\otoprule
 		Suscripción \textit{Ngrok}  & 7,33 \\
		Lineas \textit{Vodafone} (x4) & 30 \\\hubu
		\textbf{Total (por 6 meses)} & $763.68$\\
		\bottomrule
	\end{tabular}
	\caption{Costes de servicios.}
	\label{tab:costes_servicios}
\end{table}

Los costes totales se pueden observar en la \autoref{tab:costes_totales}.

\begin{table}[H]
	\centering
	\begin{tabular}[]{@{}l r@{}}
		\toprule
		\textbf{Servicio} & \textbf{Coste (\euro{})}\\
		\otoprule
		Costes de personal  & 24\,573,36 \\
		Costes de \textit{hardware} & 13\,650 \\
		Costes de servicios & $763.68$ \\\hubu
		\textbf{Total} & 38\,987,04\\
		\bottomrule
	\end{tabular}
	\caption{Costes totales.}
	\label{tab:costes_totales}
\end{table}


\subsection{Viabilidad legal}

Este proyecto se ha realizado con la ayuda de software de terceros con licencias propias que influyen sobre la viabilidad legal del proyecto.

Dentro de las licencias de las herramientas utilizadas están:
\begin{itemize}
		\item \textbf{MIT}: Esta licencia permite el uso comercial del producto, la modificación del mismo, la libre distribución y el uso privado. No tiene garantías ni responsabilidad. La única condición es hacer referencia a ella. Como no obliga a mantener la licencia ni afecta a la distribución del software que use la licencia final del producto, esta puede ser cualquiera.
		
		\item \textbf{GPLv3}: Licencia que permite uso comercial, distribución, modificación uso privado y creación de patentes. Obliga a licenciar
cualquier modificación del código o códigos que usen herramientas con esta licencia usar \textbf{GLPv3} u otras versiones.
		
		\item \textbf{Apache 2.0}: Licencia de las herramientas de Apache, tiene las mismas propiedades que la licencia GPLv3 con excepción de que no obliga a que las nuevas implementaciones con dependencias en Apache 2.0 sean licenciadas como código libre.

		\item \textbf{BSD}: Tiene características semejantes a MIT en el contexto en el que la usamos.
		
		\item \textbf{BSD 3-Clause}: Tiene características semejantes a MIT en el contexto en el que la usamos.
\end{itemize}

La licencia más restrictiva del proyecto, la \textit{GPLv3}, está asociada a las plantillas de imágenes \textit{docker} de Mario Juez Gil~\cite{juez2019docker}. Como el resto de licencias son compatibles con la \textit{GPLv3} se utiliza dicha licencia para todo el proyecto.

\subsubsection{\textit{Copyright} de terceros}

\textbf{Apache 2.0}:
\begin{itemize}
	\item \textit{Apache Kafka} - \textit{Apache Foundation}
	\item \textit{Apache Zookeeper} - \textit{Apache Foundation}
	\item \textit{Apache Spark} - \textit{Apache Foundation}
	\item \textit{Docker CP} - \textit{Confluentic}
	\item \textit{Jitsi Meet} - \textit{Jitsi}
\end{itemize}

\textbf{GPLv3}:
\begin{itemize}
	\item \textit{Clúster Spark Docker} - Mario Juez Gil
\end{itemize}

\textbf{BSD} todas sus variantes:
\begin{itemize}
	\item \textit{Caffe} - \textit{BVLC}
	\item \textit{Flask} - \textit{Pallets}
	\item \textit{Jinja} - \textit{Pallets}
	\item \textit{OpenCV} - \textit{Intel Corporation}, \textit{Xperience AI}
	\item \textit{Seaborn} - Michael Waskom
\end{itemize}

\textbf{MIT}
\begin{itemize}
	\item \textit{Bootstrap 4} - \textit{Twitter}
	\item \textit{jQuery} - \textit{JS Foundation}
\end{itemize}

